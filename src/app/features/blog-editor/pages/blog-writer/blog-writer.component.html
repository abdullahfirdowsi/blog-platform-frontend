<!-- Blog Writer Component -->
<div class="blog-writer" (click)="onDocumentClick($event)">
  <!-- Header -->
  <header class="writer-header">
    <div class="header-container">
      <div class="header-left">
        <button class="back-btn" (click)="discardChanges()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M10 18L2 10l8-8M2 10h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Back
        </button>
        <h1 class="page-title">Write Blog</h1>
      </div>
      
      <div class="header-actions">
        <button class="action-btn secondary" (click)="previewBlog()" [disabled]="!blogTitle || blogBlocks.length === 0">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" fill="currentColor"/>
            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" fill="currentColor"/>
          </svg>
          Preview
        </button>
        
        <button class="action-btn secondary" (click)="saveBlog()" [disabled]="isSaving || !blogTitle || blogBlocks.length === 0">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
            <path d="M5 13l4 4L19 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {{ isSaving ? 'Saving...' : 'Save Draft' }}
        </button>
        
        <button class="action-btn primary" (click)="openPublishModal()" [disabled]="!blogTitle || blogBlocks.length === 0">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
            <path d="M8 17.003V7l8 5-8 5.003z" fill="currentColor"/>
          </svg>
          Save
        </button>
      </div>
    </div>
  </header>

  <!-- Main Editor Area -->
  <main class="editor-main">
    <div class="editor-container">
      <!-- Title Input -->
      <div class="title-section">
        <input 
          type="text" 
          class="blog-title-input" 
          placeholder="Enter your blog title..."
          [(ngModel)]="blogTitle"
          maxlength="200"
        />
        <div class="title-counter">{{ blogTitle.length }}/200</div>
      </div>

      <!-- Content Blocks -->
      <div class="content-blocks">
        <!-- Empty state with add button -->
        <div *ngIf="blogBlocks.length === 0" class="empty-content">
          <div class="empty-message">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
              <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h3>Start writing your blog</h3>
            <p>Click the plus button to add your first content block</p>
          </div>
          
          <!-- Main Add Button -->
          <div class="add-block-container add-menu-container">
            <button class="add-block-btn main-add" (click)="toggleAddMenu()">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            
            <!-- Add Menu -->
            <div class="add-menu" *ngIf="showAddMenu && currentBlockId === null">
              <button 
                *ngFor="let blockType of blockTypes" 
                class="menu-item"
                (click)="addBlock(blockType.type)"
              >
                <span class="menu-icon">{{ blockType.icon }}</span>
                <span class="menu-label">{{ blockType.label }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Content Blocks List -->
        <div *ngFor="let block of blogBlocks; let i = index; trackBy: trackByBlockId" class="block-container">
          <!-- Block Content -->
          <div class="content-block" [ngClass]="'block-' + block.type">
            <!-- Block Controls -->
            <div class="block-controls">
              <div class="control-group">
                <button 
                  class="control-btn" 
                  (click)="moveBlockUp(block.id)" 
                  [disabled]="i === 0"
                  title="Move up"
                >
                  <svg width="16" height="16" viewBox="0 0 20 20" fill="none">
                    <path d="M5 12l5-5 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                
                <button 
                  class="control-btn" 
                  (click)="moveBlockDown(block.id)" 
                  [disabled]="i === blogBlocks.length - 1"
                  title="Move down"
                >
                  <svg width="16" height="16" viewBox="0 0 20 20" fill="none">
                    <path d="M15 8l-5 5-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                
                <button 
                  class="control-btn delete" 
                  (click)="removeBlock(block.id)"
                  title="Delete block"
                >
                  <svg width="16" height="16" viewBox="0 0 20 20" fill="none">
                    <path d="M6 6l8 8M14 6l-8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Block Input Based on Type -->
            <div class="block-input">
              <!-- Subtitle Block -->
              <input 
                *ngIf="block.type === 'subtitle'"
                type="text"
                class="subtitle-input"
                [id]="'block-' + block.id"
                [placeholder]="block.placeholder"
                [value]="block.data"
                (input)="onBlockChange(block.id, $any($event.target).value)"
                maxlength="150"
              />
              
              <!-- Content Block -->
              <textarea 
                *ngIf="block.type === 'content'"
                class="content-input"
                [id]="'block-' + block.id"
                [placeholder]="block.placeholder"
                [value]="block.data"
                (input)="onBlockChange(block.id, $any($event.target).value); autoResize($event)"
                rows="3"
              ></textarea>
              
              <!-- Image Block -->
              <div *ngIf="block.type === 'image'" class="image-block">
                <!-- Image Upload Options -->
                <div class="image-upload-options">
                  <button 
                    type="button" 
                    class="upload-btn" 
                    (click)="selectImageFile(block.id)"
                    [disabled]="isUploadingImage"
                  >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                      <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    {{ isUploadingImage ? 'Uploading...' : 'Upload from Device' }}
                  </button>
                  
                  <span class="upload-divider">or</span>
                  
                  <input 
                    type="url"
                    class="image-url-input"
                    [id]="'block-' + block.id"
                    placeholder="Paste image URL"
                    [value]="block.data"
                    (input)="onBlockChange(block.id, $any($event.target).value)"
                  />
                </div>
                
                <!-- Loading State -->
                <div *ngIf="isUploadingImage" class="upload-loading">
                  <div class="loading-spinner"></div>
                  <span>Uploading to AWS S3...</span>
                </div>
                
                <!-- Image Preview -->
                <div *ngIf="block.data && !isUploadingImage" class="image-preview">
                  <img [src]="block.data" [alt]="'Image preview'" (error)="onImageError($event, block.id)" />
                  <div class="image-url-display">
                    <small>{{ block.data }}</small>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Add Block Between Elements -->
          <div class="add-block-container add-menu-container">
            <button class="add-block-btn" (click)="toggleAddMenu(block.id)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 6v6m0 0v6m0-6h6m-6 0H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            
            <!-- Add Menu -->
            <div class="add-menu" *ngIf="showAddMenu && currentBlockId === block.id">
              <button 
                *ngFor="let blockType of blockTypes" 
                class="menu-item"
                (click)="addBlock(blockType.type)"
              >
                <span class="menu-icon">{{ blockType.icon }}</span>
                <span class="menu-label">{{ blockType.label }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Bottom Actions (Mobile) -->
  <div class="bottom-actions mobile-only">
    <button class="mobile-btn secondary" (click)="saveBlog()" [disabled]="isSaving || !blogTitle || blogBlocks.length === 0">
      Save Draft
    </button>
    <button class="mobile-btn primary" (click)="openPublishModal()" [disabled]="!blogTitle || blogBlocks.length === 0">
      Save
    </button>
  </div>
</div>

<!-- Publish Modal -->
<div *ngIf="showPublishModal" class="publish-modal-overlay">
  <div class="publish-modal">
    <div class="modal-header">
      <h2>Publish Blog</h2>
      <button class="close-btn" (click)="closePublishModal()">&times;</button>
    </div>

    <div class="modal-body">
      <!-- Main Image Upload -->
      <div class="form-group">
        <label>Main Image</label>
        <div class="main-image-upload">
          <button 
            type="button" 
            class="upload-btn" 
            (click)="selectMainImageFile()" 
            [disabled]="isUploadingMainImage"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span *ngIf="!isUploadingMainImage">Select from Device</span>
            <span *ngIf="isUploadingMainImage">Uploading...</span>
          </button>
          
          <div class="image-preview" *ngIf="mainImageUrl && !isUploadingMainImage">
            <img [src]="mainImageUrl" alt="Main image preview" />
            <button type="button" class="remove-btn" (click)="removeMainImage()">Remove</button>
          </div>
        </div>
      </div>

      <!-- Tags Section -->
      <div class="form-group">
        <label>Tags</label>
        
        <!-- Add Custom Tag -->
        <div class="add-tag-section">
          <div class="tag-input-group">
            <input 
              type="text" 
              class="tag-input" 
              placeholder="Enter tag name..." 
              [(ngModel)]="newTagInput"
              (keyup.enter)="addCustomTag()"
              maxlength="20"
            />
            <button 
              type="button" 
              class="add-tag-btn" 
              (click)="addCustomTag()"
              [disabled]="!newTagInput.trim()"
            >
              Add Tag
            </button>
          </div>
        </div>

        <!-- Selected Tags -->
        <div class="selected-tags" *ngIf="selectedTags.length > 0">
          <h4>Selected Tags ({{ selectedTags.length }}/10):</h4>
          <div class="tags-list">
            <span 
              *ngFor="let tag of selectedTags" 
              class="tag-item selected"
            >
              {{ tag }}
              <button 
                type="button" 
                class="remove-tag-btn" 
                (click)="removeTag(tag)"
              >
                &times;
              </button>
            </span>
          </div>
        </div>

        <!-- Recommended Tags -->
        <div class="recommended-tags" *ngIf="availableTags.length > 0">
          <h4>Recommended Tags:</h4>
          <div class="tags-grid">
            <span 
              *ngFor="let tag of availableTags" 
              class="tag-item recommended"
              [class.disabled]="selectedTags.includes(tag.name)"
              (click)="addRecommendedTag(tag.name)"
            >
              {{ tag.name }}
              <span *ngIf="selectedTags.includes(tag.name)" class="checkmark">✓</span>
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button 
        type="button" 
        class="btn secondary" 
        (click)="closePublishModal()"
      >
        Cancel
      </button>
      <button 
        type="button" 
        class="btn primary" 
        (click)="publishBlog()" 
        [disabled]="isPublishing"
      >
        <span *ngIf="!isPublishing">Publish</span>
        <span *ngIf="isPublishing">Publishing...</span>
      </button>
    </div>
  </div>
</div>

<!-- Preview Modal -->
<div *ngIf="showPreviewModal" class="preview-modal-overlay">
  <div class="preview-modal">
    <div class="modal-header">
      <h2>Blog Preview</h2>
      <button class="close-btn" (click)="closePreviewModal()">&times;</button>
    </div>

    <div class="modal-body">
      <article class="preview-article">
        <!-- Preview Header -->
        <header class="preview-header">
          <h1 class="preview-title">{{ blogTitle }}</h1>
          <div class="preview-meta">
            <span class="preview-date">{{ getFormattedDate() }}</span>
            <span class="preview-status">Draft</span>
          </div>
        </header>
        
        <!-- Preview Content -->
        <div class="preview-content">
          <div *ngFor="let block of getPreviewBlocks()" class="preview-block">
            <!-- Subtitle Block -->
            <h2 *ngIf="block.type === 'subtitle'" class="preview-subtitle">
              {{ block.data || 'Untitled Subtitle' }}
            </h2>
            
            <!-- Content Block -->
            <div *ngIf="block.type === 'content'" class="preview-text" [innerHTML]="block.data || 'No content added yet.'"></div>
            
            <!-- Image Block -->
            <div *ngIf="block.type === 'image'" class="preview-image">
              <img [src]="block.data" [alt]="'Blog image'" *ngIf="block.data" />
              <div *ngIf="!block.data" class="preview-image-placeholder">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
                  <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" fill="currentColor"/>
                </svg>
                <p>No image added</p>
              </div>
            </div>
          </div>
          
          <!-- Empty content message -->
          <div *ngIf="blogBlocks.length === 0" class="preview-empty">
            <p>No content blocks added yet.</p>
          </div>
        </div>
      </article>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn secondary" (click)="closePreviewModal()">Close</button>
      <button type="button" class="btn primary" (click)="closePreviewModal(); openPublishModal()">Publish</button>
    </div>
  </div>
</div>

<app-footer></app-footer>
