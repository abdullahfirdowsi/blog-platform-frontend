<div class="page-content">
  <app-header></app-header>
  
  <div class="main-content bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-sm p-6 mb-8">
      <div class="flex items-center space-x-6">
        <!-- Profile Avatar -->
        <div class="flex-shrink-0">
          @if (currentUser?.profile_image) {
            <img 
              class="h-20 w-20 rounded-full object-cover ring-4 ring-blue-100" 
              [src]="currentUser?.profile_image" 
              [alt]="currentUser?.username"
            >
          } @else {
            <div class="h-20 w-20 rounded-full bg-blue-500 flex items-center justify-center ring-4 ring-blue-100">
              <span class="text-2xl font-medium text-white">{{ getUserInitials() }}</span>
            </div>
          }
        </div>
        
        <!-- Profile Info -->
        <div class="flex-1 min-w-0">
          <h1 class="text-2xl font-bold text-gray-900 truncate">
            {{ currentUser?.full_name || currentUser?.username }}
          </h1>
          <p class="text-gray-600 truncate">{{ currentUser?.email }}</p>
          <div class="flex items-center mt-2 text-sm text-gray-500">
            <i [class]="getProviderIcon() + ' mr-2'"></i>
            <span>{{ getProviderText() }}</span>
            @if (currentUser?.is_verified) {
              <i class="fas fa-check-circle text-green-500 ml-2" title="Verified account"></i>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Navigation -->
    <div class="bg-white rounded-xl shadow-sm mb-8">
      <div class="border-b border-gray-200">
        <nav class="-mb-px flex">
          <button
            (click)="setActiveTab('profile')"
            [class]="activeTab === 'profile' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
            class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm transition-colors"
          >
            <i class="fas fa-user mr-2"></i>
            Profile Information
          </button>
          <button
            (click)="setActiveTab('password')"
            [class]="activeTab === 'password' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
            class="w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm transition-colors"
          >
            <i class="fas fa-lock mr-2"></i>
            Change Password
          </button>
        </nav>
      </div>
    </div>

    <!-- Profile Tab Content -->
    @if (activeTab === 'profile') {
      <div class="bg-white rounded-xl shadow-sm p-6">
        <div class="mb-6">
          <h3 class="text-lg font-medium text-gray-900 mb-2">Profile Information</h3>
          <p class="text-sm text-gray-600">Update your account's profile information and email address.</p>
        </div>

        <!-- Success/Error Messages -->
        @if (successMessage) {
          <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-md mb-6 animate-fade-in">
            <div class="flex items-center">
              <i class="fas fa-check-circle text-green-500 mr-3"></i>
              <span class="text-green-700 text-sm">{{ successMessage }}</span>
            </div>
          </div>
        }
        
        @if (errorMessage) {
          <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-md mb-6 animate-fade-in">
            <div class="flex items-center">
              <i class="fas fa-exclamation-circle text-red-500 mr-3"></i>
              <span class="text-red-700 text-sm">{{ errorMessage }}</span>
            </div>
          </div>
        }

        <!-- Profile Form -->
        <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Username -->
            <div class="space-y-1">
              <label for="username" class="block text-sm font-medium text-gray-700">
                Username
              </label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fas fa-user text-gray-400"></i>
                </div>
                <input
                  id="username"
                  type="text"
                  formControlName="username"
                  class="appearance-none relative block w-full pl-10 pr-3 py-3 border rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                  [class.border-gray-300]="!hasFieldError(profileForm, 'username')"
                  [class.border-red-500]="hasFieldError(profileForm, 'username')"
                  placeholder="Your username"
                >
              </div>
              @if (hasFieldError(profileForm, 'username')) {
                <p class="text-red-500 text-xs mt-1">
                  <i class="fas fa-exclamation-circle mr-1"></i>
                  {{ getFieldError(profileForm, 'username') }}
                </p>
              }
            </div>

            <!-- Email -->
            <div class="space-y-1">
              <label for="email" class="block text-sm font-medium text-gray-700">
                Email Address
              </label>
              <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <i class="fas fa-envelope text-gray-400"></i>
                </div>
                <input
                  id="email"
                  type="email"
                  formControlName="email"
                  class="appearance-none relative block w-full pl-10 pr-3 py-3 border rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                  [class.border-gray-300]="!hasFieldError(profileForm, 'email')"
                  [class.border-red-500]="hasFieldError(profileForm, 'email')"
                  placeholder="your@email.com"
                >
              </div>
              @if (hasFieldError(profileForm, 'email')) {
                <p class="text-red-500 text-xs mt-1">
                  <i class="fas fa-exclamation-circle mr-1"></i>
                  {{ getFieldError(profileForm, 'email') }}
                </p>
              }
            </div>
          </div>

          <!-- Full Name -->
          <div class="space-y-1">
            <label for="full_name" class="block text-sm font-medium text-gray-700">
              Full Name
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-id-card text-gray-400"></i>
              </div>
              <input
                id="full_name"
                type="text"
                formControlName="full_name"
                class="appearance-none relative block w-full pl-10 pr-3 py-3 border rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                [class.border-gray-300]="!hasFieldError(profileForm, 'full_name')"
                [class.border-red-500]="hasFieldError(profileForm, 'full_name')"
                placeholder="Your full name"
              >
            </div>
            @if (hasFieldError(profileForm, 'full_name')) {
              <p class="text-red-500 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>
                {{ getFieldError(profileForm, 'full_name') }}
              </p>
            }
          </div>

          <!-- Bio -->
          <div class="space-y-1">
            <label for="bio" class="block text-sm font-medium text-gray-700">
              Bio
            </label>
            <textarea
              id="bio"
              formControlName="bio"
              rows="4"
              class="appearance-none relative block w-full px-3 py-3 border border-gray-300 rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
              placeholder="Tell us about yourself..."
            ></textarea>
          </div>

          <!-- Submit Button -->
          <div class="flex justify-end">
            <button
              type="submit"
              [disabled]="profileForm.invalid || isLoading"
              class="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98]"
            >
              @if (isLoading) {
                <div class="flex items-center">
                  <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                  Updating...
                </div>
              } @else {
                <span class="flex items-center">
                  <i class="fas fa-save mr-2"></i>
                  Update Profile
                </span>
              }
            </button>
          </div>
        </form>
      </div>
    }

    <!-- Password Tab Content -->
    @if (activeTab === 'password') {
      <div class="bg-white rounded-xl shadow-sm p-6">
        <div class="mb-6">
          <h3 class="text-lg font-medium text-gray-900 mb-2">Change Password</h3>
          <p class="text-sm text-gray-600">Ensure your account is using a long, random password to stay secure.</p>
        </div>

        <!-- Success/Error Messages -->
        @if (passwordSuccessMessage) {
          <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-md mb-6 animate-fade-in">
            <div class="flex items-center">
              <i class="fas fa-check-circle text-green-500 mr-3"></i>
              <span class="text-green-700 text-sm">{{ passwordSuccessMessage }}</span>
            </div>
          </div>
        }
        
        @if (passwordErrorMessage) {
          <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-md mb-6 animate-fade-in">
            <div class="flex items-center">
              <i class="fas fa-exclamation-circle text-red-500 mr-3"></i>
              <span class="text-red-700 text-sm">{{ passwordErrorMessage }}</span>
            </div>
          </div>
        }

        <!-- Password Form -->
        <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()" class="space-y-6">
          <!-- Current Password -->
          <div class="space-y-1">
            <label for="current_password" class="block text-sm font-medium text-gray-700">
              Current Password
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-lock text-gray-400"></i>
              </div>
              <input
                id="current_password"
                [type]="showCurrentPassword ? 'text' : 'password'"
                formControlName="current_password"
                class="appearance-none relative block w-full pl-10 pr-10 py-3 border rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                [class.border-gray-300]="!hasFieldError(passwordForm, 'current_password')"
                [class.border-red-500]="hasFieldError(passwordForm, 'current_password')"
                placeholder="Enter current password"
              >
              <button
                type="button"
                (click)="togglePasswordVisibility('current')"
                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none"
              >
                <i [class]="showCurrentPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
              </button>
            </div>
            @if (hasFieldError(passwordForm, 'current_password')) {
              <p class="text-red-500 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>
                {{ getFieldError(passwordForm, 'current_password') }}
              </p>
            }
          </div>

          <!-- New Password -->
          <div class="space-y-1">
            <label for="new_password" class="block text-sm font-medium text-gray-700">
              New Password
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-lock text-gray-400"></i>
              </div>
              <input
                id="new_password"
                [type]="showNewPassword ? 'text' : 'password'"
                formControlName="new_password"
                class="appearance-none relative block w-full pl-10 pr-10 py-3 border rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                [class.border-gray-300]="!hasFieldError(passwordForm, 'new_password')"
                [class.border-red-500]="hasFieldError(passwordForm, 'new_password')"
                placeholder="Enter new password"
              >
              <button
                type="button"
                (click)="togglePasswordVisibility('new')"
                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none"
              >
                <i [class]="showNewPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
              </button>
            </div>
            @if (hasFieldError(passwordForm, 'new_password')) {
              <p class="text-red-500 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>
                {{ getFieldError(passwordForm, 'new_password') }}
              </p>
            }
          </div>

          <!-- Confirm Password -->
          <div class="space-y-1">
            <label for="confirm_password" class="block text-sm font-medium text-gray-700">
              Confirm New Password
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-lock text-gray-400"></i>
              </div>
              <input
                id="confirm_password"
                [type]="showConfirmPassword ? 'text' : 'password'"
                formControlName="confirm_password"
                class="appearance-none relative block w-full pl-10 pr-10 py-3 border rounded-lg placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                [class.border-gray-300]="!hasFieldError(passwordForm, 'confirm_password')"
                [class.border-red-500]="hasFieldError(passwordForm, 'confirm_password') || (!passwordsMatch() && passwordForm.get('confirm_password')?.touched)"
                placeholder="Confirm new password"
              >
              <button
                type="button"
                (click)="togglePasswordVisibility('confirm')"
                class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none"
              >
                <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
              </button>
            </div>
            @if (hasFieldError(passwordForm, 'confirm_password')) {
              <p class="text-red-500 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>
                {{ getFieldError(passwordForm, 'confirm_password') }}
              </p>
            }
            @if (!passwordsMatch() && passwordForm.get('confirm_password')?.touched && !hasFieldError(passwordForm, 'confirm_password')) {
              <p class="text-red-500 text-xs mt-1">
                <i class="fas fa-exclamation-circle mr-1"></i>
                Passwords do not match
              </p>
            }
          </div>

          <!-- Submit Button -->
          <div class="flex justify-end">
            <button
              type="submit"
              [disabled]="passwordForm.invalid || !passwordsMatch() || isPasswordLoading"
              class="bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98]"
            >
              @if (isPasswordLoading) {
                <div class="flex items-center">
                  <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                  Changing...
                </div>
              } @else {
                <span class="flex items-center">
                  <i class="fas fa-key mr-2"></i>
                  Change Password
                </span>
              }
            </button>
          </div>
        </form>
      </div>
    }
  </div>
  </div>
  
  <app-footer></app-footer>
</div>
