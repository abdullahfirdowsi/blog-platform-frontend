<!-- Modern Admin Dashboard -->
<div class="dashboard-container" [class.dark-theme]="isDarkTheme">
  <!-- Dashboard Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <h1 class="header-title">Admin Dashboard</h1>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="toggleTheme()">
          <i class="fas" [class.fa-moon]="!isDarkTheme" [class.fa-sun]="isDarkTheme"></i>
          {{ isDarkTheme ? 'Light Mode' : 'Dark Mode' }}
        </button>
        <button class="btn btn-primary" (click)="refreshData()">
          <i class="fas fa-sync-alt"></i>
          Refresh Data
        </button>
        <div class="dropdown">
          <button class="btn btn-secondary" (click)="toggleExportDropdown()">
            <i class="fas fa-download"></i>
            Export
          </button>
          <div class="dropdown-menu" *ngIf="isExportDropdownOpen">
            <a class="dropdown-item" (click)="exportToPDF()">
              <i class="fas fa-file-pdf"></i> Export as PDF
            </a>
            <a class="dropdown-item" (click)="exportToCSV()">
              <i class="fas fa-file-csv"></i> Export as CSV
            </a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Dashboard Content -->
  <main class="dashboard-content">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Loading dashboard data...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="hasError && !isLoading" class="error-container">
      <i class="fas fa-exclamation-triangle error-icon fa-3x"></i>
      <h2 class="error-title">Failed to Load Dashboard</h2>
      <p class="error-message">There was an error loading the dashboard data.</p>
      <button class="btn btn-primary" (click)="refreshData()">
        <i class="fas fa-sync-alt"></i> Try Again
      </button>
    </div>

    <!-- Dashboard Content -->
    <div *ngIf="!isLoading && !hasError">
      <!-- Filters Section -->
      <div class="dashboard-card filters-card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-filter"></i> Filters & Controls
          </h2>
        </div>
        <div class="card-body">
          <div class="filters-grid">
            <!-- Search Bar -->
            <div class="filter-group">
              <label class="filter-label">Search</label>
              <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input
                  type="text"
                  [(ngModel)]="searchTerm"
                  placeholder="Search activities, tags, users..."
                  class="search-input"
                />
              </div>
            </div>

            <!-- Time Period Filter -->
            <div class="filter-group">
              <label class="filter-label">Time Period</label>
              <select
                [(ngModel)]="selectedTimePeriod"
                (ngModelChange)="onTimePeriodChange()"
                class="filter-input"
              >
                <option *ngFor="let period of timePeriods" [value]="period.value">
                  {{ period.label }}
                </option>
              </select>
            </div>

            <!-- Category Filter -->
            <div class="filter-group">
              <label class="filter-label">Category</label>
              <select
                [(ngModel)]="selectedCategory"
                class="filter-input"
              >
                <option value="">All Categories</option>
                <option *ngFor="let category of categories" [value]="category">
                  {{ category }}
                </option>
              </select>
            </div>

            <!-- Date Range -->
            <div class="filter-group">
              <label class="filter-label">Date Range</label>
              <div class="flex gap-2">
                <input
                  type="date"
                  [(ngModel)]="startDate"
                  class="filter-input"
                  placeholder="Start date"
                />
                <input
                  type="date"
                  [(ngModel)]="endDate"
                  class="filter-input"
                  placeholder="End date"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- KPI Cards -->
      <div class="kpi-grid" *ngIf="totals">
        <div class="kpi-card">
          <div class="kpi-icon users">
            <i class="fas fa-users"></i>
          </div>
          <div class="kpi-data">
            <p class="kpi-label">Total Users</p>
            <p class="kpi-value">{{ totals.total_users | number }}</p>
            <div class="kpi-change positive">
              <i class="fas fa-arrow-up"></i> 12% from last month
            </div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon posts">
            <i class="fas fa-file-alt"></i>
          </div>
          <div class="kpi-data">
            <p class="kpi-label">Total Posts</p>
            <p class="kpi-value">{{ totals.total_posts | number }}</p>
            <div class="kpi-change positive">
              <i class="fas fa-arrow-up"></i> 8% from last month
            </div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon comments">
            <i class="fas fa-comments"></i>
          </div>
          <div class="kpi-data">
            <p class="kpi-label">Total Comments</p>
            <p class="kpi-value">{{ totals.total_comments | number }}</p>
            <div class="kpi-change positive">
              <i class="fas fa-arrow-up"></i> 15% from last month
            </div>
          </div>
        </div>

        <div class="kpi-card">
          <div class="kpi-icon likes">
            <i class="fas fa-heart"></i>
          </div>
          <div class="kpi-data">
            <p class="kpi-label">Total Likes</p>
            <p class="kpi-value">{{ totals.total_likes | number }}</p>
            <div class="kpi-change positive">
              <i class="fas fa-arrow-up"></i> 22% from last month
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="chart-grid">
        <!-- Posts by Category Chart -->
        <div class="dashboard-card">
          <div class="card-header">
            <h2 class="card-title">Posts by Category</h2>
            <span *ngIf="postsByCategory.length > 0">
              {{ postsByCategory.length }} categories
            </span>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas #pieChart *ngIf="postsByCategory.length > 0"></canvas>
              <div *ngIf="postsByCategory.length === 0" class="empty-state">
                <i class="fas fa-chart-pie empty-state-icon fa-2x"></i>
                <p class="empty-state-title">No category data available</p>
                <p class="empty-state-description">Posts will appear here once categorized</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Posts Over Time Chart -->
        <div class="dashboard-card">
          <div class="card-header">
            <h2 class="card-title">Posts Published Over Time</h2>
            <span *ngIf="postsOverTime.length > 0">
              {{ selectedTimePeriod }} view
            </span>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas #lineChart *ngIf="postsOverTime.length > 0"></canvas>
              <div *ngIf="postsOverTime.length === 0" class="empty-state">
                <i class="fas fa-chart-line empty-state-icon fa-2x"></i>
                <p class="empty-state-title">No time series data available</p>
                <p class="empty-state-description">Publication trends will appear here</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Most Liked Posts Chart -->
        <div class="dashboard-card">
          <div class="card-header">
            <h2 class="card-title">Most Liked Posts</h2>
            <span *ngIf="mostLikedPosts.length > 0">
              Top {{ mostLikedPosts.length }} posts
            </span>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas #likesChart *ngIf="mostLikedPosts.length > 0"></canvas>
              <div *ngIf="mostLikedPosts.length === 0" class="empty-state">
                <i class="fas fa-heart empty-state-icon fa-2x"></i>
                <p class="empty-state-title">No liked posts data available</p>
                <p class="empty-state-description">Popular posts will be ranked here</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Most Commented Posts Chart -->
        <div class="dashboard-card">
          <div class="card-header">
            <h2 class="card-title">Most Commented Posts</h2>
            <span *ngIf="mostCommentedPosts.length > 0">
              Top {{ mostCommentedPosts.length }} posts
            </span>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas #commentsChart *ngIf="mostCommentedPosts.length > 0"></canvas>
              <div *ngIf="mostCommentedPosts.length === 0" class="empty-state">
                <i class="fas fa-comments empty-state-icon fa-2x"></i>
                <p class="empty-state-title">No commented posts data available</p>
                <p class="empty-state-description">Engaging posts will appear here</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Section -->
      <div class="chart-grid">
        <!-- Recent Activity -->
        <div class="dashboard-card">
          <div class="card-header">
            <h2 class="card-title">Recent Activity</h2>
            <span *ngIf="getFilteredActivity().length > 0">
              {{ getFilteredActivity().length }} activities
            </span>
          </div>
          <div class="card-body">
            <div class="activity-feed">
              <div *ngFor="let activity of getFilteredActivity(); trackBy: trackByActivityId" 
                   class="activity-item">
                <div class="activity-dot"></div>
                <div class="activity-content">
                  <p class="activity-text">{{ activity.description }}</p>
                  <div class="activity-time">
                    <i class="fas fa-user"></i> {{ activity.user }} • 
                    <i class="fas fa-clock"></i> {{ activity.created_at | date:'short' }}
                  </div>
                </div>
              </div>
              <div *ngIf="getFilteredActivity().length === 0" class="empty-state">
                <i class="fas fa-history empty-state-icon fa-2x"></i>
                <p class="empty-state-title">No recent activity found</p>
                <p class="empty-state-description">Activity will appear here as users interact</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Top Contributors -->
        <div class="dashboard-card">
          <div class="card-header">
            <h2 class="card-title">Top Contributors</h2>
            <span *ngIf="topContributors.length > 0">
              Top {{ topContributors.length }}
            </span>
          </div>
          <div class="card-body">
            <table class="data-table" *ngIf="topContributors.length > 0">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Username</th>
                  <th>Posts</th>
                  <th>Comments</th>
                  <th>Score</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let contributor of topContributors; let i = index">
                  <td><strong>{{ i + 1 }}</strong></td>
                  <td>{{ contributor.username }}</td>
                  <td>{{ contributor.post_count }}</td>
                  <td>{{ contributor.comment_count }}</td>
                  <td><strong>{{ contributor.total_score }}</strong></td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="topContributors.length === 0" class="empty-state">
              <i class="fas fa-users empty-state-icon fa-2x"></i>
              <p class="empty-state-title">No contributors found</p>
              <p class="empty-state-description">Active users will be ranked here</p>
            </div>
          </div>
        </div>

        <!-- Trending Tags -->
        <div class="dashboard-card">
          <div class="card-header">
            <h2 class="card-title">Trending Tags</h2>
            <span *ngIf="getFilteredTags().length > 0">
              {{ getFilteredTags().length }} tags
            </span>
          </div>
          <div class="card-body">
            <table class="data-table" *ngIf="getFilteredTags().length > 0">
              <thead>
                <tr>
                  <th>Tag</th>
                  <th>Posts</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let tag of getFilteredTags(); let i = index">
                  <td>
                    <span class="status-badge" [class.status-active]="i < 3" [class.status-pending]="i >= 3 && i < 6" [class.status-inactive]="i >= 6">
                      #{{ tag.tag }}
                    </span>
                  </td>
                  <td>{{ tag.count }}</td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="getFilteredTags().length === 0" class="empty-state">
              <i class="fas fa-tags empty-state-icon fa-2x"></i>
              <p class="empty-state-title">No tags found</p>
              <p class="empty-state-description">Popular tags will appear here</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>